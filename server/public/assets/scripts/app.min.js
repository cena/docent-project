/*! docentedu 2015-09-25 */
var embedName="",logo="",embedLink="",howto="",description="",category="",subject="",tags="",pageNumber=1,resources=[],value="",filteredArray=[],query;$(document).ready(function(){function a(){filteredArray.length>0?(g(filteredArray),f(filteredArray)):1==search?c(function(a){g(a),f(a)}):b(function(a){g(a),f(a)})}function b(a){filteredArray=[],$.ajax({type:"GET",dataType:"json",url:"/resources",success:function(b){b.resources.sort(e),a(b.resources)}})}function c(a,b){filteredArray=[],console.log(a),$.ajax({type:"POST",dataType:"json",data:{search:a},url:"/resources",success:function(a){console.log(a),b(a)}})}function d(a,b,c){switch(filteredArray=[],a){case"category":for(i=0;i<c.length;i++)c[i].category===b&&filteredArray.push(c[i]);break;case"subject":for(i=0;i<c.length;i++)c[i].subject===b&&filteredArray.push(c[i]);for(i=0;i<c.length;i++)null==c[i].subject&&filteredArray.push(c[i]);break;case"tag":for(var d=0;d<c.length;d++)if(null!=c[d].tags)for(var e=0;e<c[d].tags.length;e++)c[d].tags[e]===b&&filteredArray.push(c[d]);break;default:filteredArray=c}return filteredArray}function e(a,b){return a.embedName<b.embedName?-1:a.embedName>b.embedName?1:0}function f(a){for($(".pageNav").empty(),numOfPages=Math.ceil(a.length/30),pageNumber>1&&$(".pageNav").append('<img class ="arrow" data-page-turn="-1" src="/assets/images/nav_backArrow.svg">'),i=1;i<=numOfPages;i++)$(".pageNav").append("<div data-page="+i+' class="pageNum">'+i+"</div>");pageNumber<numOfPages&&$(".pageNav").append('<img class ="arrow" data-page-turn="1" src="/assets/images/nav_forwardArrow.svg">'),$(".pageNum").removeClass("currentPage"),$(".pageNum[data-page="+pageNumber+"]").addClass("currentPage")}function g(a){$("#cardContainer").empty();for(var b=30*pageNumber-30;b<a.length&&30*pageNumber>b;b++){var c="Description Coming Soon";if(tags="",embedName=a[b].embedName,logo=a[b].logo?a[b].logo:a[b].embedName,embedLink=a[b].embedLink?a[b].embedLink:a[b].embedName,howto=a[b].howto?a[b].howto:"",description=a[b].description?a[b].description:c,category=a[b].category?a[b].category:"",subject=a[b].subject?"":a[b].embedName,null!==a[b].tags&&0!==a[b].tags)for(var d=0;d<a[b].tags.length;d++)tags+='<p class="tag">'+a[b].tags[d]+"</p>";var e='<img class="logo" src="'+logo+'">',f='<main class="col-xs-offset-1 col-xs-12 col-sm-offset-3 col-sm-6 col-md-offset-1 col-md-4 col-lg-offset-0 card"></main>',g='<div class="col-xs-offset-1 col-xs-10">'+e+"</div>",h='<h3 class="category col-xs-offset-5 col-xs-10">'+category+"</h3>",i='<div class="col-md-offset-1"><iframe width="290" height="150" src="'+howto+'" frameborder="0" allowfullscreen></iframe></iframe></div>',j='<p class="paragraph col-md-offset-1 col-md-10">'+description+"</p>",k=' <h4 class="col-xs-offset-3">Example</h4><i data-id='+a[b]._id+' class="example fa fa-external-link fa-2x"></i>',l='<h6 class="tags col-md-3">'+tags+"</h6>";$("#cardContainer").append(f),$(".card").last().append('<div class="row">'+g+'</div><div class="row">'+h+'</div><div class="row">'+i+'</div><div class="row">'+j+'</div><div class="row">'+k+'</div><div class="row">'+l+"</div>")}}function h(a){console.log("hello"),$.ajax({type:"GET",dataType:"json",url:"api/resources/"+a,success:function(a){var b=a.embedLink;$("#embedExample").append(b),b=b.replace(/</g,"&lt"),b=b.replace(/>/g,"&gt"),$("#embedLink").html(b)},error:function(a){console.log(a)}})}$(".navDirectory").on("mouseenter",function(){$(".sub-nav").stop().slideUp(500),$(this).find(".sub-nav").stop().slideDown(500)}),$(".navDirectory").on("mouseleave",function(){$(".sub-nav").stop().slideUp(500),$(this).find(".sub-nav").stop().slideUp(500)}),$("body").on("click",".example",function(){h($(this).data("id")),$("#embedExample").empty(),$("#embedLink").empty(),$("#myModal").modal("show");var a='<iframe src="https://www.haikudeck.com/e/SnptnKTSEr/?isUrlHashEnabled=false&isPreviewEnabled=false&isHeaderVisible=false" width="520" height="341" frameborder="0" marginheight="0" marginwidth="0"></iframe><br/><span style="font-family: arial, sans-serif; font-size: 8pt;"><a title="Heat Presentation" href="https://www.haikudeck.com/p/SnptnKTSEr/heat?utm_campaign=embed&utm_source=webapp&utm_medium=text-link">Heat</a> - Created with Haiku Deck, presentation software that inspires</span>';$("#embedExample").append(a),a=a.replace(/</g,"&lt"),a=a.replace(/>/g,"&gt"),$("#embedLink").html(a)}),$("body").on("click",".pageNum",function(){pageNumber=$(this).data("page"),a()}),$("body").on("click",".arrow",function(){pageNumber+=$(this).data("page-turn"),b(function(b){a()})}),$("body").on("click","#submit",function(a){a.preventDefault(),query=$("#search").val(),null!=query&&" "!=query&&c(query,function(a){g(a),f(a),console.log("search")})}),b(function(a){g(a),f(a),console.log(a),$("body").on("click",".tag",function(){return value=$(this).text(),pageNumber=1,d("tag",value,a),g(filteredArray),f(filteredArray),filteredArray}),$("body").on("click",".category",function(){return value=$(this).text(),pageNumber=1,d("category",value,a),g(filteredArray),f(filteredArray),filteredArray}),$("body").on("click",".subject",function(){return value=$(this).text(),pageNumber=1,d("subject",value,a),g(filteredArray),f(filteredArray),filteredArray})}),$(".seeAllResources").on("click",function(){b(function(a){g(a),f(a)})})});